# 스트레스 체크 기능 설계 (Stress Diagnosis Design)

## 1. 개요 (Overview)
본 문서는 스트레스 체크(직무 스트레스 검사) 기능의 데이터 구조, 점수 계산 로직, 그리고 API 설계를 기술합니다.

### 참고 자료 (References)
- **메인 로직**: [JP 스트레스 체크 결과지](https://do0ori.notion.site/JP-2ea8ad3586848090b817d68ea0a53a9a?pvs=74)
- **소점 환산표 (S1~S19)**: [Score-to-Scale Mapping](https://do0ori.notion.site/2ed8ad35868480578079dd9cde360b89?v=2ed8ad358684808f96fd000c38c6b1f6)

---

## 2. 데이터 구조 (Data Structure)

### 2.1 문항 데이터 (`backend/questions.json`)
- **출처**: 엑셀 원본 데이터 (CSV 추출)
- **구성**: 총 57문항
  - **A 영역 (직무 스트레스 요인)**: 17문항 (A1 ~ A17)
  - **B 영역 (스트레스 반응)**: 29문항 (B1 ~ B29)
  - **C 영역 (사회적 지원)**: 9문항 (C1 ~ C9)
  - **D 영역 (만족도)**: 2문항 (D1 ~ D2)
- **형식**: `ID` (예: `A1`), `텍스트`, `선택지(점수)`

### 2.2 요인 정의 데이터 (`backend/factor_definitions.json`)
- **용도**: 문항 조합 및 계산 규칙 정의 (Base + Weight)
- **형식**:
  ```json
  "F-A1": {
    "label": "양적 부담",
    "base": 15,
    "weights": { "A1": -1, "A2": -1, "A3": -1 }, // 계산식: base + sum(answer * weight)
    "scales": { "male": "S1", "female": "S2" },
    "group": 1
  }
  ```

### 2.3 환산표 데이터 (`backend/scoring_maps.json`)
- **출처**: Notion 데이터 (S1 ~ S19)
- **용도**: 각 요인의 원점수(Raw Score)를 5단계 척도(5-Step Scale)로 변환 (시각화용)
- **형식**: `{ "S1": { "1": {"min": 3, "max": 5}, ... } }` (해당 점수 구간 정의)

---

## 3. 평가 로직 (Evaluation Logic)

### 3.1 소점 계산 (Sub-score Calculation)
사용자 응답(1~4점)을 기반으로 각 요인별 원점수를 계산합니다.

| 영역 | 요인 | 계산식 | 환산표 | 평가 그룹 |
| :--- | :--- | :--- | :--- | :--- |
| **A** | F-A1. 양적 부담 | $15 - (A1 + A2 + A3)$ | S1(남), S2(여) | 1 (역순) |
|      | F-A2. 질적 부담 | $15 - (A4 + A5 + A6)$ | S1(남), S3(여) | 1 (역순) |
|      | F-A3. 신체적 부담 | $5 - A7$ | S4 | 1 (역순) |
|      | F-A4. 대인 관계 | $10 - (A12 + A13) + A14$ | S5 | 1 (역순) |
|      | F-A5. 직무 환경 | $5 - A15$ | S4(남), S6(여) | 1 (역순) |
|      | F-A6. 직무 통제 | $15 - (A8 + A9 + A10)$ | S3(남), S8(여) | 2 (정순) |
|      | F-A7. 기술 활용 | $A11$ | S7 | 2 (정순) |
|      | F-A8. 직무 적성 | $5 - A16$ | S9 | 2 (정순) |
|      | F-A9. 직무 보람 | $5 - A17$ | S9 | 2 (정순) |
| **B** | F-B1. 활기 | $B1 + B2 + B3$ | S5 | 2 (정순) |
|      | F-B2. 짜증감 | $B4 + B5 + B6$ | S5(남), S8(여) | 1 (역순) |
|      | F-B3. 피로감 | $B7 + B8 + B9$ | S10(남), S11(여) | 1 (역순) |
|      | F-B4. 불안감 | $B10 + B11 + B12$ | S12(남), S10(여) | 1 (역순) |
|      | F-B5. 우울감 | $\sum(B13 \sim B18)$ | S13(남), S14(여) | 1 (역순) |
|      | F-B6. 신체적 호소 | $\sum(B19 \sim B29)$ | S15(남), S16(여) | 1 (역순) |
| **C** | F-C1. 상사의 지원 | $15 - (C1 + C4 + C7)$ | S3(남), S17(여) | 2 (정순) |
|      | F-C2. 동료의 지원 | $15 - (C2 + C5 + C8)$ | S1 | 2 (정순) |
|      | F-C3. 가족/친구 지원 | $15 - (C3 + C6 + C9)$ | S18 | 2 (정순) |
| **D** | F-D1. 만족도 | $10 - (D1 + D2)$ | S19 | 2 (정순) |



### 3.2 척도 변환 (Conversion) - 5단계 척도
산출된 **원점수**를 성별에 맞는 **환산표(S1~S19)에 대입**하여 **5단계(1~5)의 상태**를 판별합니다.
이 단계는 판정용이 아닌, 결과 리포트에서 **상태 수준(낮음/적음 ~ 높음/많음)을** 시각화하기 위함입니다.

- **1단계**: 낮음 / 적음
- **2단계**: 다소 낮음 / 다소 적음
- **3단계**: 보통
- **4단계**: 다소 높음 / 다소 많음
- **5단계**: 높음 / 많음

### 3.3 결과 시각화 (Visualization) - 레이더 차트
결과는 다음 **3개의 레이더 차트**로 나누어 시각화합니다.
1.  **스트레스 요인 (A)**: F-A1 ~ F-A9
2.  **스트레스 반응 (B)**: F-B1 ~ F-B6
3.  **지원 요인 (C & D)**: F-C1 ~ F-C3, F-D1

- **축(Axis)**: 위에서 정의한 **각 요인(Factor)** (예: `F-A1`, `F-B1` 등)
- **방향**: **차트의 중심에 가까울수록 스트레스가 높음(부정적)을** 의미합니다.

따라서 요인의 척도(1\~5단계)를 차트 좌표(1\~5점, 5가 바깥쪽)로 변환할 때 다음 규칙을 따릅니다.

**목표**: 바깥쪽(5점)일수록 '건강함/양호함', 안쪽(1점)일수록 '스트레스 높음/나쁨'

- **그룹 1 (원점수가 높을수록 나쁨)**: 양적 부담, 짜증감, 피로감 등
  - 척도 5(높음/많음) $\to$ **차트 1점 (중심)** (나쁨)
  - 척도 1(낮음/적음) $\to$ **차트 5점 (바깥)** (좋음)
  - **계산식**: $Chart Point = 6 - Scale$

- **그룹 2 (원점수가 높을수록 좋음)**: 직무 통제, 동료의 지원, 만족도 등
  - 척도 5(높음/많음) $\to$ **차트 5점 (바깥)** (좋음)
  - 척도 1(낮음/적음) $\to$ **차트 1점 (중심)** (나쁨)
  - **계산식**: $Chart Point = Scale$

### 3.4 고스트레스자 판정 (High Stress Determination) - 합계점 방식
CSV 파일에 명시된 기준에 따라, **원점수 단순 합계**를 기준으로 판정합니다. (환산 점수 미사용)

다음 **두 가지 조건 중 하나라도 만족하면** 고스트레스자로 판정합니다.

1.  **조건 1**: **B 영역 합계** (원점수) $\ge 77$
2.  **조건 2**: **A 영역 + C 영역 합계** (원점수) $\ge 76$ **AND** **B 영역 합계** (원점수) $\ge 63$

> [!NOTE]
> 상기 원점수 합계 방식은 데이터(`questions.json`)에 정의된 배점(1~4점)을 그대로 합산하여 계산합니다. A, B, C 영역 모두 **점수가 높을수록 스트레스 요인/반응이 높음(나쁨)을 의미**하도록 배점되어 있습니다.

---

## 4. API 설계 (API Specification)

### Request
`POST /api/diagnosis`

```json
{
  "gender": "male", // "male" or "female" (환산표 적용 시 필요)
  "answers": {
    "A1": 4,
    "A2": 3,
    ...
    "D2": 1
  }
}
```

### Response
```json
{
  "result": {
    "high_stress": true,
    "summary_scores": {
      "sum_a": 78,
      "sum_b": 80,
      "sum_c": 15
    }
  },
  "charts": [
    {
      "label": "스트레스 요인 (A)",
      "axes": [
        { "id": "F-A1", "label": "양적 부담", "score": 2 },
        { "id": "F-A2", "label": "질적 부담", "score": 3 },
        ...
      ]
    },
    {
      "label": "스트레스 반응 (B)",
      "axes": [...]
    },
    {
      "label": "지원 요인 (C & D)",
      "axes": [...]
    }
  ]
}
```

---

## 5. 종합 직무 스트레스 진단 (Organization Diagnosis) - 개인 리포트용

### 5.1 개요
조직 진단용 지표(건강 리스크 산출 공식)를 활용하여, 개인의 **직무 스트레스 요인(Job Stress)과** **사회적 지원(Social Support)** 상태를 4가지 핵심 축으로 분석합니다.
기존의 2차원 산점도 방식에서 **1차원 막대 그래프(Bar Chart)** 방식으로 변경하여 직관성을 높였습니다.

### 5.2 평가 지표 (4 Factors)
모든 지표는 **점수가 높을수록 긍정적(양호)인** 방향으로 통일했습니다.

| 지표명 (UI) | 원본 데이터 (Factor) | 계산 방식 (점수 통일) | 범위 |
| :--- | :--- | :--- | :--- |
| **업무 여유도** | 양적 직무 부담 (A1+A2+A3) | $15 - (A1+A2+A3)$ | 3(나쁨) ~ 12(좋음) |
| **직무 재량권** | 직무 통제 (A8+A9+A10) | $A8+A9+A10$ | 3(나쁨) ~ 12(좋음) |
| **상사의 지원** | 상사의 지원 (C1+C4+C7) | $C1+C4+C7$ | 3(나쁨) ~ 12(좋음) |
| **동료의 지원** | 동료의 지원 (C2+C5+C8) | $C2+C5+C8$ | 3(나쁨) ~ 12(좋음) |

> **Note**: '양적 직무 부담'은 원래 점수가 높을수록 스트레스가 심한(부정적) 요인이므로, $15 - Score$ 를 통해 '업무 여유도(긍정적)'로 역산하여 표현합니다.

### 5.3 5단계 등급 체계 (Grading System)
산출된 점수(3~12점)를 5단계 구간으로 나누어 평가합니다. (소수점 포함, 연속 구간)

| 등급 (Level) | 점수 구간 (Score) | 상태 설명 |
| :---: | :---: | :--- |
| **매우 좋음** | **11.0 이상 ~ 12.0 이하** | 매우 긍정적이고 건강한 상태입니다. |
| **좋음** | **9.0 이상 ~ 11.0 미만** | 양호한 편입니다. |
| **보통** | **7.0 이상 ~ 9.0 미만** | 평균적인 수준입니다. |
| **나쁨** | **5.0 이상 ~ 7.0 미만** | 개선이 필요한 상태입니다. |
| **매우 나쁨** | **3.0 이상 ~ 5.0 미만** | 위험한 수준으로, 조치가 시급합니다. |

### 5.4 건강 리스크 판정 (Health Risk)
건강 리스크 점수는 **'직무 스트레스 판정 도표 (Job Stress Model)'의** 수리적 모델을 기반으로 산출됩니다. 
즉, **4가지 요인의 좌표(Score)를** 판정 공식에 대입하여 계산된 결과가 바로 **건강 리스크(학술적 예측치)**입니다.

- **계산 원리**: 각 축의 점수가 표준 평균(전국 평균 등 기준점)에서 얼마나 벗어나 있는지, 그리고 그것이 건강에 미치는 영향도(가중치)를 반영하여 지수 함수($Risk = 100 \times e^{\dots}$)로 계산합니다.


